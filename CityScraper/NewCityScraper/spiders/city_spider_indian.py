import scrapy
import re  # Import for regular expressions

class CityParagraphsSpider(scrapy.Spider):
  name = "indian_city_data_scraper"
  start_urls = [
    "https://en.wikipedia.org/wiki/Mumbai","https://en.wikipedia.org/wiki/Delhi","https://en.wikipedia.org/wiki/Bangalore","https://en.wikipedia.org/wiki/Hyderabad","https://en.wikipedia.org/wiki/Ahmedabad","https://en.wikipedia.org/wiki/Chennai","https://en.wikipedia.org/wiki/Kolkata","https://en.wikipedia.org/wiki/Surat","https://en.wikipedia.org/wiki/Pune","https://en.wikipedia.org/wiki/Jaipur","https://en.wikipedia.org/wiki/Lucknow","https://en.wikipedia.org/wiki/Kanpur","https://en.wikipedia.org/wiki/Nagpur","https://en.wikipedia.org/wiki/Indore","https://en.wikipedia.org/wiki/Thane","https://en.wikipedia.org/wiki/Bhopal","https://en.wikipedia.org/wiki/Visakhapatnam","https://en.wikipedia.org/wiki/Pimpri-Chinchwad","https://en.wikipedia.org/wiki/Patna","https://en.wikipedia.org/wiki/Vadodara","https://en.wikipedia.org/wiki/Ghaziabad,_India","https://en.wikipedia.org/wiki/Ludhiana","https://en.wikipedia.org/wiki/Agra","https://en.wikipedia.org/wiki/Nashik","https://en.wikipedia.org/wiki/Faridabad","https://en.wikipedia.org/wiki/Meerut","https://en.wikipedia.org/wiki/Rajkot","https://en.wikipedia.org/wiki/Vasai-Virar","https://en.wikipedia.org/wiki/Varanasi","https://en.wikipedia.org/wiki/Srinagar","https://en.wikipedia.org/wiki/Aurangabad,_Maharashtra","https://en.wikipedia.org/wiki/Dhanbad","https://en.wikipedia.org/wiki/Amritsar","https://en.wikipedia.org/wiki/Navi_Mumbai","https://en.wikipedia.org/wiki/Prayagraj","https://en.wikipedia.org/wiki/Howrah","https://en.wikipedia.org/wiki/Ranchi","https://en.wikipedia.org/wiki/Jabalpur","https://en.wikipedia.org/wiki/Gwalior","https://en.wikipedia.org/wiki/Coimbatore","https://en.wikipedia.org/wiki/Vijayawada","https://en.wikipedia.org/wiki/Jodhpur","https://en.wikipedia.org/wiki/Madurai","https://en.wikipedia.org/wiki/Raipur","https://en.wikipedia.org/wiki/Kota,_Rajasthan","https://en.wikipedia.org/wiki/Guwahati","https://en.wikipedia.org/wiki/Chandigarh","https://en.wikipedia.org/wiki/Thiruvananthapuram","https://en.wikipedia.org/wiki/Solapur","https://en.wikipedia.org/wiki/Hubballi-Dharwad","https://en.wikipedia.org/wiki/Tiruchirappalli","https://en.wikipedia.org/wiki/Tiruppur","https://en.wikipedia.org/wiki/Moradabad","https://en.wikipedia.org/wiki/Mysore","https://en.wikipedia.org/wiki/Bareilly","https://en.wikipedia.org/wiki/Gurgaon","https://en.wikipedia.org/wiki/Aligarh","https://en.wikipedia.org/wiki/Jalandhar","https://en.wikipedia.org/wiki/Bhubaneswar","https://en.wikipedia.org/wiki/Salem,_Tamil_Nadu","https://en.wikipedia.org/wiki/Mira-Bhayandar","https://en.wikipedia.org/wiki/Warangal","https://en.wikipedia.org/wiki/Guntur","https://en.wikipedia.org/wiki/Bhiwandi","https://en.wikipedia.org/wiki/Saharanpur","https://en.wikipedia.org/wiki/Gorakhpur","https://en.wikipedia.org/wiki/Bikaner","https://en.wikipedia.org/wiki/Amravati","https://en.wikipedia.org/wiki/Noida","https://en.wikipedia.org/wiki/Jamshedpur","https://en.wikipedia.org/wiki/Bhilai","https://en.wikipedia.org/wiki/Cuttack","https://en.wikipedia.org/wiki/Firozabad","https://en.wikipedia.org/wiki/Kochi,_India","https://en.wikipedia.org/wiki/Nellore","https://en.wikipedia.org/wiki/Bhavnagar","https://en.wikipedia.org/wiki/Dehradun","https://en.wikipedia.org/wiki/Durgapur,_West_Bengal","https://en.wikipedia.org/wiki/Asansol","https://en.wikipedia.org/wiki/Rourkela","https://en.wikipedia.org/wiki/Nanded","https://en.wikipedia.org/wiki/Kolhapur","https://en.wikipedia.org/wiki/Ajmer","https://en.wikipedia.org/wiki/Akola_city","https://en.wikipedia.org/wiki/Gulbarga","https://en.wikipedia.org/wiki/Jamnagar","https://en.wikipedia.org/wiki/Ujjain","https://en.wikipedia.org/wiki/Loni,_India","https://en.wikipedia.org/wiki/Siliguri","https://en.wikipedia.org/wiki/Jhansi","https://en.wikipedia.org/wiki/Jammu","https://en.wikipedia.org/wiki/Mangalore","https://en.wikipedia.org/wiki/Erode","https://en.wikipedia.org/wiki/Belgaum","https://en.wikipedia.org/wiki/Ambattur","https://en.wikipedia.org/wiki/Tirunelveli","https://en.wikipedia.org/wiki/Malegaon","https://en.wikipedia.org/wiki/Gaya,_India","https://en.wikipedia.org/wiki/Jalgaon","https://en.wikipedia.org/wiki/Udaipur","https://en.wikipedia.org/wiki/Maheshtala","https://en.wikipedia.org/wiki/Davanagere","https://en.wikipedia.org/wiki/Kozhikode","https://en.wikipedia.org/wiki/Kurnool","https://en.wikipedia.org/wiki/Rajpur_Sonarpur","https://en.wikipedia.org/wiki/Rajahmundry","https://en.wikipedia.org/wiki/Bokaro_Steel_City","https://en.wikipedia.org/wiki/Bellary","https://en.wikipedia.org/wiki/Patiala","https://en.wikipedia.org/wiki/Agartala","https://en.wikipedia.org/wiki/Bhagalpur","https://en.wikipedia.org/wiki/Muzaffarnagar","https://en.wikipedia.org/wiki/Bhatpara","https://en.wikipedia.org/wiki/Panihati","https://en.wikipedia.org/wiki/Latur","https://en.wikipedia.org/wiki/Dhule","https://en.wikipedia.org/wiki/Tirupati","https://en.wikipedia.org/wiki/Korba,_Chhattisgarh","https://en.wikipedia.org/wiki/Bhilwara","https://en.wikipedia.org/wiki/Berhampur","https://en.wikipedia.org/wiki/Muzaffarpur","https://en.wikipedia.org/wiki/Ahmednagar","https://en.wikipedia.org/wiki/Mathura","https://en.wikipedia.org/wiki/Kollam","https://en.wikipedia.org/wiki/Avadi","https://en.wikipedia.org/wiki/Kadapa","https://en.wikipedia.org/wiki/Kamarhati","https://en.wikipedia.org/wiki/Sambalpur","https://en.wikipedia.org/wiki/Bilaspur,_Chhattisgarh","https://en.wikipedia.org/wiki/Satara_(city)","https://en.wikipedia.org/wiki/Bijapur,_Karnataka","https://en.wikipedia.org/wiki/Rampur,_Uttar_Pradesh","https://en.wikipedia.org/wiki/Shivamogga","https://en.wikipedia.org/wiki/Chandrapur","https://en.wikipedia.org/wiki/Junagadh","https://en.wikipedia.org/wiki/Thrissur","https://en.wikipedia.org/wiki/Alwar","https://en.wikipedia.org/wiki/Bardhaman","https://en.wikipedia.org/wiki/Kakinada","https://en.wikipedia.org/wiki/Nizamabad,_Telangana","https://en.wikipedia.org/wiki/Parbhani","https://en.wikipedia.org/wiki/Tumkur","https://en.wikipedia.org/wiki/Khammam","https://en.wikipedia.org/wiki/Bihar_Sharif","https://en.wikipedia.org/wiki/Panipat","https://en.wikipedia.org/wiki/Darbhanga","https://en.wikipedia.org/wiki/Bally,_Howrah","https://en.wikipedia.org/wiki/Aizawl","https://en.wikipedia.org/wiki/Dewas","https://en.wikipedia.org/wiki/Ichalkaranji","https://en.wikipedia.org/wiki/Karnal","https://en.wikipedia.org/wiki/Bathinda","https://en.wikipedia.org/wiki/Jalna_(city)","https://en.wikipedia.org/wiki/Eluru","https://en.wikipedia.org/wiki/Barasat","https://en.wikipedia.org/wiki/Purnia","https://en.wikipedia.org/wiki/Satna","https://en.wikipedia.org/wiki/Mau,_Uttar_Pradesh","https://en.wikipedia.org/wiki/Sonipat","https://en.wikipedia.org/wiki/Farrukhabad","https://en.wikipedia.org/wiki/Sagar,_Madhya_Pradesh","https://en.wikipedia.org/wiki/Rourkela","https://en.wikipedia.org/wiki/Durg","https://en.wikipedia.org/wiki/Imphal","https://en.wikipedia.org/wiki/Ratlam","https://en.wikipedia.org/wiki/Arrah","https://en.wikipedia.org/wiki/Karimnagar","https://en.wikipedia.org/wiki/Anantapur","https://en.wikipedia.org/wiki/Etawah","https://en.wikipedia.org/wiki/Ambernath","https://en.wikipedia.org/wiki/North_Dumdum","https://en.wikipedia.org/wiki/Begusarai","https://en.wikipedia.org/wiki/New_Delhi","https://en.wikipedia.org/wiki/Gandhidham","https://en.wikipedia.org/wiki/Baranagar","https://en.wikipedia.org/wiki/Tiruvottiyur","https://en.wikipedia.org/wiki/Pondicherry_(city)","https://en.wikipedia.org/wiki/Sikar","https://en.wikipedia.org/wiki/Thoothukudi","https://en.wikipedia.org/wiki/Rewa,_India","https://en.wikipedia.org/wiki/Mirzapur","https://en.wikipedia.org/wiki/Raichur","https://en.wikipedia.org/wiki/Pali,_Rajasthan","https://en.wikipedia.org/wiki/Ramagundam","https://en.wikipedia.org/wiki/Haridwar","https://en.wikipedia.org/wiki/Vizianagaram","https://en.wikipedia.org/wiki/Katihar","https://en.wikipedia.org/wiki/Nagarcoil","https://en.wikipedia.org/wiki/Sri_Ganganagar","https://en.wikipedia.org/wiki/Mango_(Jamshedpur)","https://en.wikipedia.org/wiki/Thanjavur","https://en.wikipedia.org/wiki/Bulandshahr","https://en.wikipedia.org/wiki/Uluberia","https://en.wikipedia.org/wiki/Nadiad","https://en.wikipedia.org/wiki/Secunderabad","https://en.wikipedia.org/wiki/Naihati","https://en.wikipedia.org/wiki/Yamunanagar","https://en.wikipedia.org/wiki/Bidhan_Nagar","https://en.wikipedia.org/wiki/Pallavaram","https://en.wikipedia.org/wiki/Bidar","https://en.wikipedia.org/wiki/Munger","https://en.wikipedia.org/wiki/Panchkula","https://en.wikipedia.org/wiki/Burhanpur","https://en.wikipedia.org/wiki/Kharagpur","https://en.wikipedia.org/wiki/Dindigul","https://en.wikipedia.org/wiki/Gandhinagar","https://en.wikipedia.org/wiki/Hospet","https://en.wikipedia.org/wiki/Malda,_West_Bengal","https://en.wikipedia.org/wiki/Ongole","https://en.wikipedia.org/wiki/Deoghar","https://en.wikipedia.org/wiki/Chhapra","https://en.wikipedia.org/wiki/Haldia","https://en.wikipedia.org/wiki/Khandwa","https://en.wikipedia.org/wiki/Nandyal","https://en.wikipedia.org/wiki/Chittoor,_Andhra_Pradesh","https://en.wikipedia.org/wiki/Morena","https://en.wikipedia.org/wiki/Amroha","https://en.wikipedia.org/wiki/Anand,_Gujarat","https://en.wikipedia.org/wiki/Madhyamgram","https://en.wikipedia.org/wiki/Bhiwani","https://en.wikipedia.org/wiki/Navi_Mumbai","https://en.wikipedia.org/wiki/Baharampur","https://en.wikipedia.org/wiki/Ambala","https://en.wikipedia.org/wiki/Fatehpur,_Uttar_Pradesh","https://en.wikipedia.org/wiki/Rae_Bareli","https://en.wikipedia.org/wiki/Bhusawal","https://en.wikipedia.org/wiki/Orai","https://en.wikipedia.org/wiki/Bahraich","https://en.wikipedia.org/wiki/Vellore","https://en.wikipedia.org/wiki/Mahesana","https://en.wikipedia.org/wiki/Sambalpur","https://en.wikipedia.org/wiki/Raiganj","https://en.wikipedia.org/wiki/Sirsa","https://en.wikipedia.org/wiki/Serampore","https://en.wikipedia.org/wiki/Jaunpur,_Uttar_Pradesh","https://en.wikipedia.org/wiki/Panvel","https://en.wikipedia.org/wiki/Unnao","https://en.wikipedia.org/wiki/Hugli-Chinsura","https://en.wikipedia.org/wiki/Alappuzha","https://en.wikipedia.org/wiki/Kottayam","https://en.wikipedia.org/wiki/Machilipatnam","https://en.wikipedia.org/wiki/Shimla","https://en.wikipedia.org/wiki/Adoni","https://en.wikipedia.org/wiki/Tenali","https://en.wikipedia.org/wiki/Proddatur","https://en.wikipedia.org/wiki/Saharsa","https://en.wikipedia.org/wiki/Hindupur","https://en.wikipedia.org/wiki/Sasaram","https://en.wikipedia.org/wiki/Hajipur","https://en.wikipedia.org/wiki/Bhimavaram","https://en.wikipedia.org/wiki/Madanapalle","https://en.wikipedia.org/wiki/Siwan,_Bihar","https://en.wikipedia.org/wiki/Bettiah","https://en.wikipedia.org/wiki/Srikakulam","https://en.wikipedia.org/wiki/Motihari","https://en.wikipedia.org/wiki/Dharmavaram,_Anantapur_district","https://en.wikipedia.org/wiki/Gudivada","https://en.wikipedia.org/wiki/Narasaraopet","https://en.wikipedia.org/wiki/Karaikudi","https://en.wikipedia.org/wiki/Suryapet","https://en.wikipedia.org/wiki/Jamalpur,_Bihar","https://en.wikipedia.org/wiki/Kavali","https://en.wikipedia.org/wiki/Tadepalligudem","https://en.wikipedia.org/wiki/Amaravati","https://en.wikipedia.org/wiki/Buxar","https://en.wikipedia.org/wiki/Aurangabad,_Bihar"]


  def clean_paragraph_text(self, text):
    pattern = r"""
    # Match optional leading slash (/)
    (/)?

    # Match optional pronunciation section (captured group 1)
    (\[(?:\s*|\S| )*\]|\([^)]*\)|<[^>]*>)*?        

    # Match optional comma, whitespace, or specific characters (captured group 2)
    (?:,\s*|\s*(?:Kannada pronunciation:|, IAST: Muṃbaī; formerly known as Bombay\[a\]))?

    # Optional trailing characters with specific class (captured group 3)
    (\s*|\s* *.mw-parser-output\s*.*?)?
"""

    # Replace matched parts with an empty string
    text = re.sub(pattern, "", text)
    text = re.sub(r'\[([^\]]+)\]', '', text)      
    return text.strip()  # Remove leading/trailing whitespace

  def parse(self, response):
    city_name = response.url.split("/")[-1]  # Extract city name from URL

    paragraphs = []
    for paragraph in response.css("p"):
      # Get text content
      paragraph_text = paragraph.css("::text").getall()
      # Join paragraph text parts and clean
      paragraph_text = self.clean_paragraph_text("".join(paragraph_text))
      paragraphs.append(paragraph_text)
      # paragraphs.append("".join(paragraph_text))

    # Create a dictionary for the city data (if paragraphs and image exist)
    if paragraphs:
      city_data = {
        "city": city_name,
        "paragraphs": " ".join(paragraphs).strip()
      }
      yield city_data
